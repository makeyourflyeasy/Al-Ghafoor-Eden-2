Project overview & agent notes

- **Stack**: React + TypeScript + Vite + Tailwind. Dev server is Vite (`npm run dev`).
- **Single-page, client-only app**: There is no backend — state is persisted to `localStorage` via `context/DataContext.tsx`. Firebase code is intentionally disabled (`firebase.ts`).

Key files (read first)
- `App.tsx` — application entry: chooses between public homepage, `LoginPage`, and `Dashboard` (authenticated view).
- `context/DataContext.tsx` — single source of truth. Exposes `useData()` hook with data arrays, setters, and handlers (payments, expenses, notifications, backups, monthly automation, etc.).
- `constants.ts` & `types.ts` — canonical data models and the initial seed data (important when adjusting domain logic or defaults).
- `components/` — UI components and pages. `Dashboard.tsx`, `LoginPage.tsx` and `Icons.tsx` show common patterns and shared utilities.
- `vite.config.ts` — dev server runs on port `9002` and builds to `build/` (not `dist/`).

Architecture & data flow (practical summary)
- All app state lives client-side in `DataProvider` (wraps the app). Use `const { flats, users, processPayment } = useData()` to read/modify state.
- Persistence: `useSyncState` reads/writes `localStorage` with versioned keys prefixed by `v2-titanium-dec1-...`. When changing data shape, update these keys or provide a migration path.
- ID conventions:
  - Owner user IDs: `${flatId}own` (e.g. `101own`).
  - Tenant user IDs: `${flatId}tnt`.
  - Admin and staff use short ids like `admin`, `faisal`, `tahir`.
- Transaction IDs: generated by `getNextTransactionId()` (format: `EDEN00001`), used for payments, expenses, loans.

Important behaviors to be aware of
- Monthly automation (in `DataContext`) runs on the 1st of each month and:
  - Generates monthly dues for all flats (50% if vacant).
  - Creates recurring expenses from `INITIAL_RECURRING_EXPENSES`.
  - Records that it ran using localStorage key `v2-titanium-dec1-monthly-run`.
  Testers should know this will only run when `new Date().getDate() === 1` unless you modify the code for local testing.
- Notification loop runs on a 30s interval to generate reminders (also handled client-side). Tenant reminders run on day 4 with a distinct localStorage run key.
- Payments: use `processPayment({ flatId, amount, date, purpose, receiverId })` to apply funds to dues; it updates `payments`, `flats` (dues/advanceBalance) and `users` (cashOnHand).

Development & common commands
- Install & run dev server:
  - `npm install`
  - `npm run dev` — Vite dev server (binds to `0.0.0.0:9002` per `vite.config.ts`).
- Build for production: `npm run build` (output -> `build/`).
- Lint: `npm run lint` (ESLint configured for `.ts/.tsx`).
- Node: this project expects Node >= 18 (see `package.json`).

Project-specific conventions & patterns
- Strict TypeScript: `tsconfig.json` uses `strict` and `noEmit` — keep type safety when changing models.
- Local-only mode: `firebase.ts` is present but intentionally disabled. Do not add server-side assumptions unless adding a real backend and migration.
- LocalStorage keys are *versioned* (e.g. `v2-titanium-dec1-*`). When changing shapes, prefer bumping keys to avoid silent runtime errors for existing users.
- UI styling: Tailwind classes are used inline across components. Reuse `components/Icons.tsx` for consistent icons.

Examples (how an agent should make changes)
- Read/write app data via `useData()` rather than touching `localStorage` directly. Example:

  ```ts
  const { flats, setFlats, processPayment } = useData();
  // mark payment
  const p = processPayment({ flatId: '101', amount: 6000, date: new Date().toISOString(), purpose: 'Maintenance', receiverId: 'faisal' });
  ```

- To add a new recurring expense, update `INITIAL_RECURRING_EXPENSES` in `constants.ts`. The monthly automation will pick it up.

Notes for AI agents editing this repo
- Prefer small, localized changes. `DataContext.tsx` is the core — refactor with care and keep the public API (`useData()`) stable.
- When modifying persistence, update or migrate the `v2-titanium-dec1-*` localStorage keys.
- Do not enable Firebase or assume network persistence: the app currently intentionally runs in local/Vercel-only mode.
- Testing automation flows: change the date-check guards in `DataContext` temporarily, or write unit tests that mock `Date` and `localStorage`.

If anything in this file is unclear or you want instructions expanded (examples, more code snippets, or tests), tell me which area to improve. 

AI client note
- The project previously referenced `@google/genai` in source and importmaps. During dependency resolution that package/version wasn't available in some environments, so source imports were switched to the official `@google/generative-ai` package and the importmap was updated.
- Changes made by the agent:
  - Replaced `import { GoogleGenAI, Type } from "@google/genai"` with `@google/generative-ai` in `components/dashboard/*`.
  - Updated `index.html` importmap to reference `@google/generative-ai`.
  - Removed temporary `@google/genai` alias from `package.json`.
- If you prefer the original import name (`@google/genai`) for browser importmaps, map it to the CDN entry for `@google/generative-ai` in `index.html`. If runtime errors appear, send the console stack trace and the agent will adapt usage to the package's actual exported API.
